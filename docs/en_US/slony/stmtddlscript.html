<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>EXECUTE SCRIPT</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.66.1">
<link rel="start" href="index.html" title="Slony-I HEAD_20050707 Documentation">
<link rel="up" href="cmds.html" title="Configuration and Action commmands">
<link rel="prev" href="stmtfailover.html" title="FAILOVER">
<link rel="next" href="stmtupdatefunctions.html" title="UPDATE FUNCTIONS">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="refentry" lang="en">
<a name="stmtddlscript"></a><div class="titlepage"></div>
<div class="refnamediv">
<h2>Name</h2>
<p>EXECUTE SCRIPT &#8212;  Execute SQL/DDL script  </p>
</div>
<div class="refsynopsisdiv">
<h2>Synopsis</h2>
<div class="cmdsynopsis"><p><tt class="command">EXECUTE SCRIPT (options);</tt></p></div>
</div>
<div class="refsect1" lang="en">
<a name="id2556601"></a><h2>Description</h2>
<p> Executes a script containing arbitrary SQL statements on
     all nodes that are subscribed to a set at a common controlled
     point within the replication transaction stream.</p>
<p> The specified event origin must be the origin of the set.
     The script file must not contain any <tt class="command">START</tt> or
     <tt class="command">COMMIT TRANSACTION</tt> calls.  (This may change in
     PostgreSQL 8.0 once nested transactions, aka savepoints, are
     supported) In addition, non-deterministic DML statements (like
     updating a field with <tt class="function">CURRENT_TIMESTAMP</tt>) must
     be avoided, since the data changes done by the script are
     explicitly not replicated. </p>
<div class="variablelist"><dl>
<dt><span class="term"><tt class="literal"> SET ID = ival </tt></span></dt>
<dd><p> The unique numeric ID number of the set affected by the script</p></dd>
<dt><span class="term"><tt class="literal"> FILENAME = '/path/to/file' </tt></span></dt>
<dd>
<p> The name of the file containing the SQL script to
	execute.  This might be a relative path, relative to the location of
	the <span class="application">slonik</span> instance you are running, or, preferably,
	an absolute path on the system where <span class="application">slonik</span> is to run.</p>
<p> The <span class="emphasis"><em>contents</em></span> of the file are propagated as part of
	the event, so the file does not need to be accessible on any of the
	nodes.</p>
</dd>
<dt><span class="term"><tt class="literal"> EVENT NODE = ival </tt></span></dt>
<dd><p> (Optional) The ID of the current origin of the set.  Default value is 1.</p></dd>
<dt><span class="term"><tt class="literal"> EXECUTE ONLY ON = ival
       </tt></span></dt>
<dd><p> (Optional) The ID of the only
	node to actually execute the script.  This option causes the
	script to be propagated by all nodes but executed only by one.
	The default is to execute the script on all nodes that are
	subscribed to the set.</p></dd>
</dl></div>
<p> See also the warnings in <a href="ddlchanges.html" title="14. Database Schema Changes (DDL)">Section 14, &#8220;Database Schema Changes (DDL)&#8221;</a>.</p>
<p> Note that this is a <a href="locking.html" title="10. Locking Issues"> locking
    operation, </a> which means that it can get stuck behind other
    database activity.</p>
<p> At the start of this event, all tables in the specified set
    are unlocked via the function
    <tt class="function">alterTableRestore(tab_id)</tt>.  After the SQL
    script has run, they are returned to &#8220;<span class="quote">replicating
    state</span>&#8221; using
    <tt class="function">alterTableForReplication(tab_id)</tt>.  This means
    that all of these tables are locked by this <span class="application"> slon
    </span> process for the duration of the SQL script
    execution.</p>
<p> If a table's columns are modified, it is very important
    that the triggers be regenerated, otherwise they may be
    inappropriate for the new form of the table schema.</p>
<p> This uses <a href="function.ddlscript-integer-text-integer.html">schemadocddlscript( integer, text, integer )</a>. </p>
</div>
<div class="refsect1" lang="en">
<a name="id2556771"></a><h2>Example</h2>
<pre class="programlisting">EXECUTE SCRIPT (
   SET ID = 1,
   FILENAME = '/tmp/changes_2004-05-01.sql',
   EVENT NODE = 1
);
    </pre>
</div>
</div></body>
</html>
