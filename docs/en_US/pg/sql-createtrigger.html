<HTML
><HEAD
><TITLE
>CREATE TRIGGER</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.73
"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 7.3.3 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="SQL Commands"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="CREATE TABLE AS"
HREF="sql-createtableas.html"><LINK
REL="NEXT"
TITLE="CREATE TYPE"
HREF="sql-createtype.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
NAME="creation"
CONTENT="2003-05-24T21:33:34"></HEAD
><BODY
CLASS="REFENTRY"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PostgreSQL 7.3.3 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sql-createtableas.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sql-createtype.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-CREATETRIGGER"
>CREATE TRIGGER</A
></H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN41245"
></A
><H2
>Name</H2
>   CREATE TRIGGER
  &nbsp;--&nbsp;   define a new trigger
  </DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN41248"
></A
><H2
>Synopsis</H2
><PRE
CLASS="SYNOPSIS"
>CREATE TRIGGER <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> { BEFORE | AFTER } { <TT
CLASS="REPLACEABLE"
><I
>event</I
></TT
> [OR ...] }
    ON <TT
CLASS="REPLACEABLE"
><I
>table</I
></TT
> FOR EACH { ROW | STATEMENT }
    EXECUTE PROCEDURE <TT
CLASS="REPLACEABLE"
><I
>func</I
></TT
> ( <TT
CLASS="REPLACEABLE"
><I
>arguments</I
></TT
> )
  </PRE
><DIV
CLASS="REFSECT2"
><A
NAME="R2-SQL-CREATETRIGGER-1"
></A
><H3
>    Inputs
   </H3
><P
>&#13;    <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
></DT
><DD
><P
>	The name to give the new trigger.  This must be distinct from the name
	of any other trigger for the same table.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>event</I
></TT
></DT
><DD
><P
>	One of INSERT, DELETE or UPDATE.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>table</I
></TT
></DT
><DD
><P
>	The name (optionally schema-qualified) of the table the trigger is for.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>func</I
></TT
></DT
><DD
><P
>	A user-supplied function that is declared as taking no arguments
	and returning type <TT
CLASS="LITERAL"
>trigger</TT
>.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>arguments</I
></TT
></DT
><DD
><P
>        An optional comma-separated list of arguments to be provided to the
	function when the trigger is executed, along with the standard trigger
	data such as old and new tuple contents.  The arguments are literal
	string constants.  Simple names and numeric constants may be written
	here too, but they will all be converted to strings.
       </P
></DD
></DL
></DIV
><P>
   </P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="R2-SQL-CREATETRIGGER-2"
></A
><H3
>    Outputs
   </H3
><P
>&#13;    <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="COMPUTEROUTPUT"
>CREATE TRIGGER
       </TT
></DT
><DD
><P
>	This message is returned if the trigger is successfully created.
       </P
></DD
></DL
></DIV
><P>
   </P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="R1-SQL-CREATETRIGGER-1"
></A
><H2
>   Description
  </H2
><P
>   <TT
CLASS="COMMAND"
>CREATE TRIGGER</TT
> will enter a new trigger into the current
   data base.  The trigger will be associated with the relation
   <TT
CLASS="REPLACEABLE"
><I
>table</I
></TT
> and will execute
   the specified function <TT
CLASS="REPLACEABLE"
><I
>func</I
></TT
>.
  </P
><P
>   The trigger can be specified to fire either before BEFORE the
   operation is attempted on a tuple (before constraints are checked and
   the <TT
CLASS="COMMAND"
>INSERT</TT
>, <TT
CLASS="COMMAND"
>UPDATE</TT
> or
   <TT
CLASS="COMMAND"
>DELETE</TT
> is attempted) or AFTER the operation has
   been attempted (e.g., after constraints are checked and the
   <TT
CLASS="COMMAND"
>INSERT</TT
>, <TT
CLASS="COMMAND"
>UPDATE</TT
> or
   <TT
CLASS="COMMAND"
>DELETE</TT
> has completed). If the trigger fires before
   the event, the trigger may skip the operation for the current tuple,
   or change the tuple being inserted (for <TT
CLASS="COMMAND"
>INSERT</TT
> and
   <TT
CLASS="COMMAND"
>UPDATE</TT
> operations only). If the trigger fires
   after the event, all changes, including the last insertion, update,
   or deletion, are <SPAN
CLASS="QUOTE"
>"visible"</SPAN
> to the trigger.
  </P
><P
>   If multiple triggers of the same kind are defined for the same event,
   they will be fired in alphabetical order by name.
  </P
><P
>  <TT
CLASS="COMMAND"
>SELECT</TT
> does not modify any rows so you can not
  create <TT
CLASS="COMMAND"
>SELECT</TT
> triggers. Rules and views are more
  appropriate in such cases.
  </P
><P
>   Refer to the chapters on SPI and Triggers in the
   <I
CLASS="CITETITLE"
>PostgreSQL Programmer's Guide</I
>  for  more
   information.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="SQL-CREATETRIGGER-NOTES"
></A
><H2
>Notes</H2
><P
>   To create a trigger on a table, the user must have the
   <TT
CLASS="LITERAL"
>TRIGGER</TT
> privilege on the table.
  </P
><P
>   In <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> versions before 7.3, it was
   necessary to declare trigger functions as returning the placeholder
   type <TT
CLASS="TYPE"
>opaque</TT
>, rather than <TT
CLASS="TYPE"
>trigger</TT
>.  To support loading
   of old dump files, <TT
CLASS="COMMAND"
>CREATE TRIGGER</TT
> will accept a function
   declared as returning <TT
CLASS="TYPE"
>opaque</TT
>, but it will issue a NOTICE and
   change the function's declared return type to <TT
CLASS="TYPE"
>trigger</TT
>.
  </P
><P
>   As of the current release, <TT
CLASS="LITERAL"
>STATEMENT</TT
> triggers are not implemented.
  </P
><P
>   Refer to the <A
HREF="sql-droptrigger.html"
><I
>DROP TRIGGER</I
></A
> command for
   information on how to remove triggers.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="R1-SQL-CREATETRIGGER-2"
></A
><H2
>Examples</H2
><P
>   Check if the specified distributor code exists in the distributors
   table before appending or updating a row in the table films:

</P><PRE
CLASS="PROGRAMLISTING"
>CREATE TRIGGER if_dist_exists
    BEFORE INSERT OR UPDATE ON films FOR EACH ROW
    EXECUTE PROCEDURE check_primary_key ('did', 'distributors', 'did');</PRE
><P>
  </P
><P
>   Before cancelling a distributor or updating its code, remove every
   reference to the table films:
</P><PRE
CLASS="PROGRAMLISTING"
>CREATE TRIGGER if_film_exists 
    BEFORE DELETE OR UPDATE ON distributors FOR EACH ROW
    EXECUTE PROCEDURE check_foreign_key (1, 'CASCADE', 'did', 'films', 'did');</PRE
><P>
  </P
><P
>   The second example can also be done by using a foreign key,
   constraint as in:

</P><PRE
CLASS="PROGRAMLISTING"
>CREATE TABLE distributors (
    did      DECIMAL(3),
    name     VARCHAR(40),
    CONSTRAINT if_film_exists
    FOREIGN KEY(did) REFERENCES films
    ON UPDATE CASCADE ON DELETE CASCADE  
);</PRE
><P>
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="SQL-CREATETRIGGER-COMPATIBILITY"
></A
><H2
>Compatibility</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>SQL92</DT
><DD
><P
>      There is no <TT
CLASS="COMMAND"
>CREATE TRIGGER</TT
> statement in <SPAN
CLASS="ACRONYM"
>SQL92</SPAN
>.
     </P
></DD
><DT
>SQL99</DT
><DD
><P
>      The <TT
CLASS="COMMAND"
>CREATE TRIGGER</TT
> statement in
      <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> implements a subset of the
      SQL99 standard.  The following functionality is missing:
      <P
></P
></P><UL
><LI
><P
>         SQL99 allows triggers to fire on updates to specific columns
         (e.g., <TT
CLASS="LITERAL"
>AFTER UPDATE OF col1, col2</TT
>).
        </P
></LI
><LI
><P
>         SQL99 allows you to define aliases for the <SPAN
CLASS="QUOTE"
>"old"</SPAN
>
         and <SPAN
CLASS="QUOTE"
>"new"</SPAN
> rows or tables for use in the definition
         of the triggered action (e.g., <TT
CLASS="LITERAL"
>CREATE TRIGGER ... ON
         tablename REFERENCING OLD ROW AS somename NEW ROW AS
         othername ...</TT
>).  Since
         <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> allows trigger
         procedures to be written in any number of user-defined
         languages, access to the data is handled in a
         language-specific way.
        </P
></LI
><LI
><P
>         <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> only has row-level
         triggers, no statement-level triggers.
        </P
></LI
><LI
><P
>         <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> only allows the
         execution of a stored procedure for the triggered action.
         SQL99 allows the execution of a number of other SQL commands,
         such as <TT
CLASS="COMMAND"
>CREATE TABLE</TT
> as triggered action.
         This limitation is not hard to work around by creating a
         stored procedure that executes these commands.
        </P
></LI
></UL
><P>
     </P
><P
>      SQL99 specifies that multiple triggers should be fired in
      time-of-creation order.  <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>
      uses name order, which was judged more convenient to work with.
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN41381"
></A
><H2
>See Also</H2
><A
HREF="sql-createfunction.html"
><I
>CREATE FUNCTION</I
></A
>, <A
HREF="sql-altertrigger.html"
><I
>ALTER TRIGGER</I
></A
>, <A
HREF="sql-droptrigger.html"
><I
>DROP TRIGGER</I
></A
>, <I
CLASS="CITETITLE"
>PostgreSQL Programmer's Guide</I
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-createtableas.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-createtype.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>CREATE TABLE AS</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>CREATE TYPE</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>