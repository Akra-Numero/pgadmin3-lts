<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>REINDEX</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 7.4beta2 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="SQL Commands"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="PREPARE"
HREF="sql-prepare.html"><LINK
REL="NEXT"
TITLE="RESET"
HREF="sql-reset.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
NAME="creation"
CONTENT="2003-08-27T02:55:32"></HEAD
><BODY
CLASS="REFENTRY"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PostgreSQL 7.4beta2 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sql-prepare.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sql-reset.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-REINDEX"
></A
>REINDEX</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN43402"
></A
><H2
>Name</H2
>REINDEX&nbsp;--&nbsp;rebuild indexes</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN43405"
></A
><H2
>Synopsis</H2
><PRE
CLASS="SYNOPSIS"
>REINDEX { DATABASE | TABLE | INDEX } <VAR
CLASS="REPLACEABLE"
>name</VAR
> [ FORCE ]</PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN43408"
></A
><H2
>Description</H2
><P
>   <TT
CLASS="COMMAND"
>REINDEX</TT
> rebuilds an index based on the data
   stored in the table, replacing the old copy of the index. There are
   two main reasons to use <TT
CLASS="COMMAND"
>REINDEX</TT
>:

   <P
></P
></P><UL
><LI
><P
>      An index has become corrupted, and no longer contains valid
      data. Although in theory this should never happen, in
      practice indexes may become corrupted due to software bugs or
      hardware failures.  <TT
CLASS="COMMAND"
>REINDEX</TT
> provides a
      recovery method.
     </P
></LI
><LI
><P
>      The index in question contains a lot of dead index pages that
      are not being reclaimed. This can occur with B-tree indexes in PostgreSQL
      under certain access patterns. <TT
CLASS="COMMAND"
>REINDEX</TT
>
      provides a way to reduce the space consumption of the index by
      writing a new version of the index without the dead pages. See
      <A
HREF="routine-reindex.html"
>Section 21.2</A
> for more information.
     </P
></LI
></UL
><P>
  </P
><P
>   If you suspect corruption of an index on a user table, you can
   simply rebuild that index, or all indexes on the table, using
   <TT
CLASS="COMMAND"
>REINDEX INDEX</TT
> or <TT
CLASS="COMMAND"
>REINDEX
   TABLE</TT
>.  Another approach to dealing with a corrupted
   user-table index is just to drop and recreate it.  This may in fact
   be preferable if you would like to maintain some semblance of
   normal operation on the table meanwhile.  <TT
CLASS="COMMAND"
>REINDEX</TT
>
   acquires exclusive lock on the table, while <TT
CLASS="COMMAND"
>CREATE
   INDEX</TT
> only locks out writes not reads of the table.
  </P
><P
>   Things are more difficult if you need to recover from corruption of
   an index on a system table.  In this case it's important for the
   system to not have used any of the suspect indexes itself.
   (Indeed, in this sort of scenario you may find that server
   processes are crashing immediately at start-up, due to reliance on
   the corrupted indexes.)  To recover safely, the server must be shut
   down and a stand-alone <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> server
   must be started instead with the command-line options
   <VAR
CLASS="OPTION"
>-O</VAR
> and <VAR
CLASS="OPTION"
>-P</VAR
>.  (These options allow
   system table modifications and prevent use of system indexes,
   respectively.)  Then, <TT
CLASS="COMMAND"
>REINDEX DATABASE</TT
>,
   <TT
CLASS="COMMAND"
>REINDEX TABLE</TT
>, or <TT
CLASS="COMMAND"
>REINDEX INDEX</TT
> can be
   issued, depending on how much you want to reconstruct.  If in
   doubt, use <TT
CLASS="COMMAND"
>REINDEX DATABASE FORCE</TT
> to force
   reconstruction of all system indexes in the database.  Then quit
   the standalone server session and restart the real server.
  </P
><P
>   See the <A
HREF="app-postgres.html"
><SPAN
CLASS="APPLICATION"
>postgres</SPAN
></A
> reference page for more
   information about how to interact with the stand-alone server
   interface.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN43436"
></A
><H2
>Parameters</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><VAR
CLASS="LITERAL"
>DATABASE</VAR
></DT
><DD
><P
>      Recreate all system indexes of a specified database. Indexes on
      user tables are not included. This form of <TT
CLASS="COMMAND"
>REINDEX</TT
>
      can only be used in stand-alone mode (see above).
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>TABLE</VAR
></DT
><DD
><P
>      Recreate all indexes of a specified table.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>INDEX</VAR
></DT
><DD
><P
>      Recreate a specified index.
     </P
></DD
><DT
><VAR
CLASS="REPLACEABLE"
>name</VAR
></DT
><DD
><P
>      The name of the specific database, table, or index to be
      reindexed.  Table and index names may be schema-qualified.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>FORCE</VAR
></DT
><DD
><P
>      Force rebuild of system indexes.  Without this key word,
      <TT
CLASS="COMMAND"
>REINDEX</TT
> skips system indexes that are not marked
      invalid.  <VAR
CLASS="LITERAL"
>FORCE</VAR
> is irrelevant for <TT
CLASS="COMMAND"
>REINDEX
      INDEX</TT
> or when reindexing user indexes.
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN43468"
></A
><H2
>Diagnostics</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SAMP
CLASS="COMPUTEROUTPUT"
>REINDEX</SAMP
></DT
><DD
><P
>      Message returned if the indexes were successfully recreated.
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN43476"
></A
><H2
>Examples</H2
><P
>   Recreate the indexes on the table <VAR
CLASS="LITERAL"
>my_table</VAR
>:

</P><PRE
CLASS="PROGRAMLISTING"
>REINDEX TABLE my_table;</PRE
><P>
  </P
><P
>   Rebuild a single index:

</P><PRE
CLASS="PROGRAMLISTING"
>REINDEX INDEX my_index;</PRE
><P>
  </P
><P
>   Rebuild all system indexes (this will only work in a stand-alone
   server session):

</P><PRE
CLASS="PROGRAMLISTING"
>REINDEX DATABASE my_database FORCE;</PRE
><P>
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN43485"
></A
><H2
>Compatibility</H2
><P
>   There is no <TT
CLASS="COMMAND"
>REINDEX</TT
> command in the SQL standard.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-prepare.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-reset.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PREPARE</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>RESET</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>