<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Server Programming Interface</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 7.4beta2 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Server Programming"
HREF="server-programming.html"><LINK
REL="PREVIOUS"
TITLE="A Complete Example"
HREF="trigger-example.html"><LINK
REL="NEXT"
TITLE="SPI_connect"
HREF="spi-spiconnect.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
NAME="creation"
CONTENT="2003-08-27T02:55:32"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PostgreSQL 7.4beta2 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="trigger-example.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="spi-spiconnect.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="SPI"
></A
>Chapter 38. Server Programming Interface</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>38.1. <A
HREF="spi.html#SPI-INTERFACE"
>Interface Functions</A
></DT
><DD
><DL
><DT
><A
HREF="spi-spiconnect.html"
>SPI_connect</A
>&nbsp;--&nbsp;   Connects your procedure to the SPI manager.</DT
><DT
><A
HREF="spi-spifinish.html"
>SPI_finish</A
>&nbsp;--&nbsp;   Disconnects your procedure from the SPI manager.</DT
><DT
><A
HREF="spi-spiexec.html"
>SPI_exec</A
>&nbsp;--&nbsp;   Creates an execution plan (parser+planner+optimizer) and executes a query.</DT
><DT
><A
HREF="spi-spiprepare.html"
>SPI_prepare</A
>&nbsp;--&nbsp;   Prepares a plan for a query, without executing it yet</DT
><DT
><A
HREF="spi-spiexecp.html"
>SPI_execp</A
>&nbsp;--&nbsp;Executes a plan from <CODE
CLASS="FUNCTION"
>SPI_prepare</CODE
></DT
><DT
><A
HREF="spi-spicursor-open.html"
>SPI_cursor_open</A
>&nbsp;--&nbsp;Sets up a cursor using a plan created with <CODE
CLASS="FUNCTION"
>SPI_prepare</CODE
></DT
><DT
><A
HREF="spi-spicursor-find.html"
>SPI_cursor_find</A
>&nbsp;--&nbsp;Finds an existing cursor (Portal) by name</DT
><DT
><A
HREF="spi-spicursor-fetch.html"
>SPI_cursor_fetch</A
>&nbsp;--&nbsp;Fetches some rows from a cursor</DT
><DT
><A
HREF="spi-spicursor-move.html"
>SPI_cursor_move</A
>&nbsp;--&nbsp;Moves a cursor</DT
><DT
><A
HREF="spi-spicursor-close.html"
>SPI_cursor_close</A
>&nbsp;--&nbsp;Closes a cursor</DT
><DT
><A
HREF="spi-spisaveplan.html"
>SPI_saveplan</A
>&nbsp;--&nbsp;   Saves a passed plan</DT
></DL
></DD
><DT
>38.2. <A
HREF="spi-interface-support.html"
>Interface Support Functions</A
></DT
><DD
><DL
><DT
><A
HREF="spi-spifnumber.html"
>SPI_fnumber</A
>&nbsp;--&nbsp;Finds the attribute number for specified attribute name</DT
><DT
><A
HREF="spi-spifname.html"
>SPI_fname</A
>&nbsp;--&nbsp;Finds the attribute name for the specified attribute number</DT
><DT
><A
HREF="spi-spigetvalue.html"
>SPI_getvalue</A
>&nbsp;--&nbsp;Returns the string value of the specified attribute</DT
><DT
><A
HREF="spi-spigetbinval.html"
>SPI_getbinval</A
>&nbsp;--&nbsp;Returns the binary value of the specified attribute</DT
><DT
><A
HREF="spi-spigettype.html"
>SPI_gettype</A
>&nbsp;--&nbsp;Returns the type name of the specified attribute</DT
><DT
><A
HREF="spi-spigettypeid.html"
>SPI_gettypeid</A
>&nbsp;--&nbsp;Returns the type <ACRONYM
CLASS="ACRONYM"
>OID</ACRONYM
> of the specified attribute</DT
><DT
><A
HREF="spi-spigetrelname.html"
>SPI_getrelname</A
>&nbsp;--&nbsp;Returns the name of the specified relation</DT
></DL
></DD
><DT
>38.3. <A
HREF="spi-memory.html"
>Memory Management</A
></DT
><DD
><DL
><DT
><A
HREF="spi-spicopytuple.html"
>SPI_copytuple</A
>&nbsp;--&nbsp;Makes copy of tuple in upper Executor context</DT
><DT
><A
HREF="spi-spicopytupledesc.html"
>SPI_copytupledesc</A
>&nbsp;--&nbsp;Makes copy of tuple descriptor in upper Executor context</DT
><DT
><A
HREF="spi-spicopytupleintoslot.html"
>SPI_copytupleintoslot</A
>&nbsp;--&nbsp;Makes copy of tuple and descriptor in upper Executor context</DT
><DT
><A
HREF="spi-spimodifytuple.html"
>SPI_modifytuple</A
>&nbsp;--&nbsp;Creates a tuple by replacing selected fields of a given tuple</DT
><DT
><A
HREF="spi-spipalloc.html"
>SPI_palloc</A
>&nbsp;--&nbsp;Allocates memory in upper Executor context</DT
><DT
><A
HREF="spi-spirepalloc.html"
>SPI_repalloc</A
>&nbsp;--&nbsp;Re-allocates memory in upper Executor context</DT
><DT
><A
HREF="spi-spipfree.html"
>SPI_pfree</A
>&nbsp;--&nbsp;Frees memory in upper Executor context</DT
><DT
><A
HREF="spi-spifreetuple.html"
>SPI_freetuple</A
>&nbsp;--&nbsp;Frees a tuple allocated in upper Executor context</DT
><DT
><A
HREF="spi-spifreetuptable.html"
>SPI_freetuptable</A
>&nbsp;--&nbsp;Frees a tuple set created by <CODE
CLASS="FUNCTION"
>SPI_exec</CODE
> or similar function</DT
><DT
><A
HREF="spi-spifreeplan.html"
>SPI_freeplan</A
>&nbsp;--&nbsp;   Releases a previously saved plan</DT
></DL
></DD
><DT
>38.4. <A
HREF="spi-visibility.html"
>Visibility of Data Changes</A
></DT
><DT
>38.5. <A
HREF="spi-examples.html"
>Examples</A
></DT
></DL
></DIV
><P
>The <I
CLASS="FIRSTTERM"
>Server Programming Interface</I
> 
(<ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
>) gives users the
ability to run <ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
> queries inside user-defined 
<ACRONYM
CLASS="ACRONYM"
>C</ACRONYM
> functions.</P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Note: </B
>The available Procedural Languages (<ACRONYM
CLASS="ACRONYM"
>PL</ACRONYM
>) give an alternate
means to build functions that can execute queries.</P
></BLOCKQUOTE
></DIV
><P
>In fact, <ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
> is just a set of native interface functions
to simplify access to the Parser, Planner, Optimizer and Executor. 
<ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
> also does some memory management.</P
><P
>To avoid misunderstanding we'll use <I
CLASS="FIRSTTERM"
>function</I
> 
to mean <ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
> interface functions and 
<I
CLASS="FIRSTTERM"
>procedure</I
> for user-defined C-functions 
using <ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
>.</P
><P
>Procedures which use <ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
> are called by the
Executor.  The <ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
> calls recursively invoke the
Executor in turn to run queries.  When the Executor is invoked
recursively, it may itself call procedures which may make
<ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
> calls.</P
><P
>Note that if during execution of a query from a procedure the transaction is
aborted, then control will not be returned to your procedure. Rather, all work
will be rolled back and the server will wait for the next command from the
client.  This will probably be changed in future versions.</P
><P
>A related restriction is the inability to execute BEGIN, END and ABORT
(transaction control statements).  This will also be
changed in the future.</P
><P
>If successful, <ACRONYM
CLASS="ACRONYM"
>SPI</ACRONYM
> functions return a non-negative result (either via
a returned integer value or in SPI_result global variable, as described below).
On error, a negative or NULL result will be returned.</P
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SPI-INTERFACE"
>38.1. Interface Functions</A
></H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="spi-spiconnect.html"
>SPI_connect</A
>&nbsp;--&nbsp;   Connects your procedure to the SPI manager.</DT
><DT
><A
HREF="spi-spifinish.html"
>SPI_finish</A
>&nbsp;--&nbsp;   Disconnects your procedure from the SPI manager.</DT
><DT
><A
HREF="spi-spiexec.html"
>SPI_exec</A
>&nbsp;--&nbsp;   Creates an execution plan (parser+planner+optimizer) and executes a query.</DT
><DT
><A
HREF="spi-spiprepare.html"
>SPI_prepare</A
>&nbsp;--&nbsp;   Prepares a plan for a query, without executing it yet</DT
><DT
><A
HREF="spi-spiexecp.html"
>SPI_execp</A
>&nbsp;--&nbsp;Executes a plan from <CODE
CLASS="FUNCTION"
>SPI_prepare</CODE
></DT
><DT
><A
HREF="spi-spicursor-open.html"
>SPI_cursor_open</A
>&nbsp;--&nbsp;Sets up a cursor using a plan created with <CODE
CLASS="FUNCTION"
>SPI_prepare</CODE
></DT
><DT
><A
HREF="spi-spicursor-find.html"
>SPI_cursor_find</A
>&nbsp;--&nbsp;Finds an existing cursor (Portal) by name</DT
><DT
><A
HREF="spi-spicursor-fetch.html"
>SPI_cursor_fetch</A
>&nbsp;--&nbsp;Fetches some rows from a cursor</DT
><DT
><A
HREF="spi-spicursor-move.html"
>SPI_cursor_move</A
>&nbsp;--&nbsp;Moves a cursor</DT
><DT
><A
HREF="spi-spicursor-close.html"
>SPI_cursor_close</A
>&nbsp;--&nbsp;Closes a cursor</DT
><DT
><A
HREF="spi-spisaveplan.html"
>SPI_saveplan</A
>&nbsp;--&nbsp;   Saves a passed plan</DT
></DL
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="trigger-example.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="spi-spiconnect.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>A Complete Example</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="server-programming.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>SPI_connect</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>