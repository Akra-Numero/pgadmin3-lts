<HTML
><HEAD
><TITLE
>Examples</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.73
"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 7.3.3 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="PL/pgSQL - SQL Procedural Language"
HREF="plpgsql.html"><LINK
REL="PREVIOUS"
TITLE="Trigger Procedures"
HREF="plpgsql-trigger.html"><LINK
REL="NEXT"
TITLE="Porting from Oracle PL/SQL"
HREF="plpgsql-porting.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
NAME="creation"
CONTENT="2003-05-24T21:33:34"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PostgreSQL 7.3.3 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="plpgsql-trigger.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 19. <SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
> - <SPAN
CLASS="ACRONYM"
>SQL</SPAN
> Procedural Language</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="plpgsql-porting.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PLPGSQL-EXAMPLES"
>19.10. Examples</A
></H1
><P
>    Here are only a few functions to demonstrate how easy it is to
    write <SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
>
    functions. For more complex examples the programmer
    might look at the regression test for <SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
>.
   </P
><P
>    One painful detail in writing functions in
	<SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
> is the handling of single
	quotes. The function's source text in <TT
CLASS="COMMAND"
>CREATE FUNCTION</TT
>
	must be a literal string. Single quotes inside of literal strings
	must be either doubled or quoted with a backslash. We are still
	looking for an elegant alternative. In the meantime, doubling the
	single quotes as in the examples below should be used. Any
	solution for this in future versions of
	<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> will be forward compatible.
   </P
><P
>    For a detailed explanation and examples of how to escape single
    quotes in different situations, please see <A
HREF="plpgsql-porting.html#PLPGSQL-QUOTE"
>Section 19.11.1.1</A
>.
   </P
><DIV
CLASS="EXAMPLE"
><A
NAME="AEN36309"
></A
><P
><B
>Example 19-2. A Simple <SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
> Function to Increment an Integer</B
></P
><P
>     The following two <SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
> functions are identical to their
     counterparts from the C language function discussion. This
     function receives an <TT
CLASS="TYPE"
>integer</TT
> and increments it by
     one, returning the incremented value.
    </P
><PRE
CLASS="PROGRAMLISTING"
>CREATE FUNCTION add_one (integer) RETURNS INTEGER AS '
    BEGIN
        RETURN $1 + 1;
    END;
' LANGUAGE 'plpgsql';</PRE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="AEN36316"
></A
><P
><B
>Example 19-3. A Simple <SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
> Function to Concatenate Text</B
></P
><P
>     This function receives two <TT
CLASS="TYPE"
>text</TT
> parameters and
     returns the result of concatenating them.
    </P
><PRE
CLASS="PROGRAMLISTING"
>CREATE FUNCTION concat_text (TEXT, TEXT) RETURNS TEXT AS '
    BEGIN
        RETURN $1 || $2;
    END;
' LANGUAGE 'plpgsql';</PRE
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="AEN36322"
></A
><P
><B
>Example 19-4. A <SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
> Function on Composite Type</B
></P
><P
>     In this example, we take <TT
CLASS="LITERAL"
>EMP</TT
> (a table) and an
     <TT
CLASS="TYPE"
>integer</TT
> as arguments to our function, which returns
     a <TT
CLASS="TYPE"
>boolean</TT
>. If the <TT
CLASS="STRUCTFIELD"
>salary</TT
> field of the <TT
CLASS="STRUCTNAME"
>EMP</TT
> table is
     <TT
CLASS="LITERAL"
>NULL</TT
>, we return <TT
CLASS="LITERAL"
>f</TT
>. Otherwise we compare with
     that field with the <TT
CLASS="TYPE"
>integer</TT
> passed to the function
     and return the <TT
CLASS="TYPE"
>boolean</TT
> result of the comparison (t
     or f). This is the <SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
> equivalent to the example from the C
     functions.
    </P
><PRE
CLASS="PROGRAMLISTING"
>CREATE FUNCTION c_overpaid (EMP, INTEGER) RETURNS BOOLEAN AS '
    DECLARE
        emprec ALIAS FOR $1;
        sallim ALIAS FOR $2;
    BEGIN
        IF emprec.salary ISNULL THEN
            RETURN ''f'';
        END IF;
        RETURN emprec.salary &#62; sallim;
    END;
' LANGUAGE 'plpgsql';</PRE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="plpgsql-trigger.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="plpgsql-porting.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Trigger Procedures</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="plpgsql.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Porting from Oracle PL/SQL</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>