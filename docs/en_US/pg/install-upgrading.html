<HTML
><HEAD
><TITLE
>If You Are Upgrading</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.73
"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 7.3.3 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="  Installation Instructions"
HREF="installation.html"><LINK
REL="PREVIOUS"
TITLE="Getting The Source"
HREF="install-getsource.html"><LINK
REL="NEXT"
TITLE="Installation Procedure"
HREF="install-procedure.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
NAME="creation"
CONTENT="2003-05-24T21:33:34"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PostgreSQL 7.3.3 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="install-getsource.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 1. Installation Instructions</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="install-procedure.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="INSTALL-UPGRADING"
>1.4. If You Are Upgrading</A
></H1
><A
NAME="AEN18166"
></A
><P
>   The internal data storage format changes with new releases of
   <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>. Therefore, if you are upgrading an
   existing installation that does not have a version number
   <SPAN
CLASS="QUOTE"
>"7.3.x"</SPAN
>, you must back up and restore your
   data as shown here. These instructions assume that your existing
   installation is under the <TT
CLASS="FILENAME"
>/usr/local/pgsql</TT
> directory,
   and that the data area is in <TT
CLASS="FILENAME"
>/usr/local/pgsql/data</TT
>.
   Substitute your paths appropriately.
  </P
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>     Make sure that your database is not updated during or after the
     backup. This does not affect the integrity of the backup, but the
     changed data would of course not be included. If necessary, edit
     the permissions in the file
     <TT
CLASS="FILENAME"
>/usr/local/pgsql/data/pg_hba.conf</TT
> (or equivalent) to
     disallow access from everyone except you.
    </P
></LI
><LI
><P
>     <A
NAME="AEN18179"
></A
>

     To back up your database installation, type:
</P><PRE
CLASS="SCREEN"
><TT
CLASS="USERINPUT"
><B
>pg_dumpall &gt; <TT
CLASS="REPLACEABLE"
><I
>outputfile</I
></TT
></B
></TT
></PRE
><P>
     If you need to preserve OIDs (such as when using them as
     foreign keys), then use the <TT
CLASS="OPTION"
>-o</TT
> option when running
     <TT
CLASS="COMMAND"
>pg_dumpall</TT
>.
    </P
><P
>     <TT
CLASS="COMMAND"
>pg_dumpall</TT
> does not
     save large objects.  Check
     
     <A
HREF="backup.html#BACKUP-DUMP-CAVEATS"
>Section 9.1.4</A
>
     if you need to do this.
    </P
><P
>     To make the backup, you can use the <TT
CLASS="COMMAND"
>pg_dumpall</TT
>
     command from the version you are currently running.  For best
     results, however, try to use the <TT
CLASS="COMMAND"
>pg_dumpall</TT
>
     command from PostgreSQL 7.3.3, since this version contains
     bug fixes and improvements over older versions.  While this
     advice might seem idiosyncratic since you haven't installed the
     new version yet, it is advisable to follow it if you plan to
     install the new version in parallel with the old version.  In
     that case you can complete the installation normally and transfer
     the data later.  This will also decrease the downtime.
    </P
></LI
><LI
><P
>     If you are installing the new version at the same location as the
     old one then shut down the old server, at the latest before you
     install the new files:
</P><PRE
CLASS="SCREEN"
><TT
CLASS="USERINPUT"
><B
>kill -INT `cat /usr/local/pgsql/data/postmaster.pid`</B
></TT
></PRE
><P>
     Versions prior to 7.0 do not have this
     <TT
CLASS="FILENAME"
>postmaster.pid</TT
> file. If you are using such a version
     you must find out the process id of the server yourself, for
     example by typing <TT
CLASS="USERINPUT"
><B
>ps ax | grep postmaster</B
></TT
>, and
     supply it to the <TT
CLASS="COMMAND"
>kill</TT
> command.
    </P
><P
>     On systems that have <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> started at boot time, there is
     probably a start-up file that will accomplish the same thing. For
     example, on a <SPAN
CLASS="SYSTEMITEM"
>Red Hat Linux</SPAN
> system one might find that
</P><PRE
CLASS="SCREEN"
><TT
CLASS="USERINPUT"
><B
>/etc/rc.d/init.d/postgresql stop</B
></TT
></PRE
><P>
     works.  Another possibility is <TT
CLASS="USERINPUT"
><B
>pg_ctl stop</B
></TT
>.
    </P
></LI
><LI
><P
>     If you are installing in the same place as the old version then
     it is also a good idea to move the old installation out of the
     way, in case you have trouble and need to revert to it.
     Use a command like this:
</P><PRE
CLASS="SCREEN"
><TT
CLASS="USERINPUT"
><B
>mv /usr/local/pgsql /usr/local/pgsql.old</B
></TT
></PRE
><P>
    </P
></LI
></OL
></DIV
><P
>   After you have installed <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> 7.3.3, create a new database
   directory and start the new server. Remember that you must execute
   these commands while logged in to the special database user account
   (which you already have if you are upgrading).
</P><PRE
CLASS="PROGRAMLISTING"
><TT
CLASS="USERINPUT"
><B
>/usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data</B
></TT
>
<TT
CLASS="USERINPUT"
><B
>/usr/local/pgsql/bin/postmaster -D /usr/local/pgsql/data</B
></TT
></PRE
><P>
   Finally, restore your data with
</P><PRE
CLASS="SCREEN"
><TT
CLASS="USERINPUT"
><B
>/usr/local/pgsql/bin/psql -d template1 -f <TT
CLASS="REPLACEABLE"
><I
>outputfile</I
></TT
></B
></TT
></PRE
><P>
   using the <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>new</I
></SPAN
> <SPAN
CLASS="APPLICATION"
>psql</SPAN
>.
  </P
><P
>   These topics are discussed at length in  <A
HREF="migration.html"
>Section 9.3</A
>, which you are encouraged to read in any
   case.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="install-getsource.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="install-procedure.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Getting The Source</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="installation.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Installation Procedure</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>