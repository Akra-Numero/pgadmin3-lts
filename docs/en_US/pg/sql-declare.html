<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>DECLARE</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 7.4beta2 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="SQL Commands"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="DEALLOCATE"
HREF="sql-deallocate.html"><LINK
REL="NEXT"
TITLE="DELETE"
HREF="sql-delete.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
NAME="creation"
CONTENT="2003-08-27T02:55:32"></HEAD
><BODY
CLASS="REFENTRY"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PostgreSQL 7.4beta2 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sql-deallocate.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sql-delete.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-DECLARE"
></A
>DECLARE</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN40946"
></A
><H2
>Name</H2
>DECLARE&nbsp;--&nbsp;define a cursor</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN40949"
></A
><H2
>Synopsis</H2
><PRE
CLASS="SYNOPSIS"
>DECLARE <VAR
CLASS="REPLACEABLE"
>cursorname</VAR
> [ BINARY ] [ INSENSITIVE ] [ [ NO ] SCROLL ]
    CURSOR [ { WITH | WITHOUT } HOLD ] FOR <VAR
CLASS="REPLACEABLE"
>query</VAR
>
    [ FOR { READ ONLY | UPDATE [ OF <VAR
CLASS="REPLACEABLE"
>column</VAR
> [, ...] ] } ]</PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN40954"
></A
><H2
>Description</H2
><P
>   <TT
CLASS="COMMAND"
>DECLARE</TT
> allows a user to create cursors, which
   can be used to retrieve
   a small number of rows at a time out of a larger query. Cursors can
   return data either in text or in binary format using
   <A
HREF="sql-fetch.html"
><I
>FETCH</I
></A
>.
  </P
><P
>   Normal cursors return data in text format, the same as a
   <TT
CLASS="COMMAND"
>SELECT</TT
> would produce.  Since data is stored natively in
   binary format, the system must do a conversion to produce the text
   format.  Once the information comes back in text form, the client
   application may need to convert it to a binary format to manipulate
   it.  In addition, data in the text format is often larger in size
   than in the binary format.  Binary cursors return the data in the
   native binary representation.  Nevertheless, if you intend to
   display the data as text anyway, retrieving it in text form will
   save you some effort on the client side.
  </P
><P
>   As an example, if a query returns a value of one from an integer column,
   you would get a string of <VAR
CLASS="LITERAL"
>1</VAR
> with a default cursor
   whereas with a binary cursor you would get
   a 4-byte value containing the internal representation of the value.
  </P
><P
>   Binary cursors should be used carefully.  Many applications,
   including <SPAN
CLASS="APPLICATION"
>psql</SPAN
>, are not prepared to
   handle binary cursors and expect data to come back in the text
   format.
  </P
><P
>   The string representation is architecture-neutral whereas binary
   representation can differ between different machine architectures.
   <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> does not resolve
   byte ordering or representation issues for binary
   cursors.</I
></SPAN
>  Therefore, if your client machine and server
   machine use different representations (e.g.,
   <SPAN
CLASS="QUOTE"
>"big-endian"</SPAN
> versus <SPAN
CLASS="QUOTE"
>"little-endian"</SPAN
>), you
   will probably not want your data returned in binary format.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN40970"
></A
><H2
>Parameters</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><VAR
CLASS="REPLACEABLE"
>cursorname</VAR
></DT
><DD
><P
>      The name of the cursor to be used in subsequent
      <TT
CLASS="COMMAND"
>FETCH</TT
> operations.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>BINARY</VAR
></DT
><DD
><P
>      Causes the cursor to return data in binary rather than in text format.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>INSENSITIVE</VAR
></DT
><DD
><P
>      Indicates that data retrieved from the cursor should be
      unaffected by updates to the tables underlying the cursor while
      the cursor exists.  In PostgreSQL, all cursors are insensitive;
      this key word currently has no effect and is present for
      compatibility with the SQL standard.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>SCROLL</VAR
><BR><VAR
CLASS="LITERAL"
>NO SCROLL</VAR
></DT
><DD
><P
>      <VAR
CLASS="LITERAL"
>SCROLL</VAR
> specifies that the cursor may be used
      to retrieve rows in a nonsequential fashion (e.g.,
      backward). Depending upon the complexity of the query's
      execution plan, specifying <VAR
CLASS="LITERAL"
>SCROLL</VAR
> may impose
      a performance penalty on the query's execution time.
      <VAR
CLASS="LITERAL"
>NO SCROLL</VAR
> specifies that the cursor cannot be
      used to retrieve rows in a nonsequential fashion.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>WITH HOLD</VAR
><BR><VAR
CLASS="LITERAL"
>WITHOUT HOLD</VAR
></DT
><DD
><P
>      <VAR
CLASS="LITERAL"
>WITH HOLD</VAR
> specifies that the cursor may
      continue to be used after the transaction that created it
      successfully commits.  <VAR
CLASS="LITERAL"
>WITHOUT HOLD</VAR
> specifies
      that the cursor cannot be used outside of the transaction that
      created it. If neither <VAR
CLASS="LITERAL"
>WITHOUT HOLD</VAR
> nor
      <VAR
CLASS="LITERAL"
>WITH HOLD</VAR
> is specified, <VAR
CLASS="LITERAL"
>WITHOUT
      HOLD</VAR
> is the default.
     </P
></DD
><DT
><VAR
CLASS="REPLACEABLE"
>query</VAR
></DT
><DD
><P
>      A <TT
CLASS="COMMAND"
>SELECT</TT
> command that will provide the rows to be
      returned by the cursor.  Refer to <A
HREF="sql-select.html"
><I
>SELECT</I
></A
> for further information about valid
      queries.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>FOR READ ONLY</VAR
><BR><VAR
CLASS="LITERAL"
>FOR UPDATE</VAR
></DT
><DD
><P
>      <VAR
CLASS="LITERAL"
>FOR READ ONLY</VAR
> indicates that the cursor will
      be used in a read-only mode.  <VAR
CLASS="LITERAL"
>FOR UPDATE</VAR
>
      indicates that the cursor will be used to update tables.  Since
      cursor updates are not currently supported in
      <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>, specifying <VAR
CLASS="LITERAL"
>FOR
      UPDATE</VAR
> will cause an error message and specifying
      <VAR
CLASS="LITERAL"
>FOR READ ONLY</VAR
> has no effect.
     </P
></DD
><DT
><VAR
CLASS="REPLACEABLE"
>column</VAR
></DT
><DD
><P
>      Column(s) to be updated by the cursor.  Since cursor updates are
      not currently supported in
      <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>, the <VAR
CLASS="LITERAL"
>FOR
      UPDATE</VAR
> clause provokes an error message.
     </P
></DD
></DL
></DIV
><P
>   The key words <VAR
CLASS="LITERAL"
>BINARY</VAR
>,
   <VAR
CLASS="LITERAL"
>INSENSITIVE</VAR
>, and <VAR
CLASS="LITERAL"
>SCROLL</VAR
> may
   appear in any order.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN41041"
></A
><H2
>Diagnostics</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SAMP
CLASS="COMPUTEROUTPUT"
>DECLARE CURSOR</SAMP
></DT
><DD
><P
>      The message returned if the cursor was successfully defined.
     </P
></DD
><DT
><SAMP
CLASS="COMPUTEROUTPUT"
>ERROR:  cursor "<VAR
CLASS="REPLACEABLE"
>cursorname</VAR
>" already exists</SAMP
></DT
><DD
><P
>      This error occurs if a cursor with the same name already exists.
     </P
></DD
><DT
><SAMP
CLASS="COMPUTEROUTPUT"
>ERROR:  DECLARE CURSOR may only be used in begin/end transaction blocks</SAMP
></DT
><DD
><P
>      This error occurs if the cursor is not declared within a
      transaction block, and <VAR
CLASS="LITERAL"
>WITH HOLD</VAR
> is not
      specified.
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN41061"
></A
><H2
>Notes</H2
><P
>    If <VAR
CLASS="LITERAL"
>WITH HOLD</VAR
> is not specified, the cursor
    created by this command can only be used within the current
    transaction. Use
    <A
HREF="sql-begin.html"
><I
>BEGIN</I
></A
>,
    <A
HREF="sql-commit.html"
><I
>COMMIT</I
></A
>
    and
    <A
HREF="sql-rollback.html"
><I
>ROLLBACK</I
></A
>
    to define a transaction block.
   </P
><P
>    If <VAR
CLASS="LITERAL"
>WITH HOLD</VAR
> is specified and the transaction
    that created the cursor successfully commits, the cursor can
    continue to be accessed by subsequent transactions in the same
    session.  (But if the creating transaction is aborted, the cursor
    is removed.)  A cursor created with <VAR
CLASS="LITERAL"
>WITH HOLD</VAR
>
    is closed when an explicit <TT
CLASS="COMMAND"
>CLOSE</TT
> command is
    issued on it, or the session ends.  In the current implementation,
    the rows represented by a held cursor are copied into a temporary
    file or memory area so that they remain available for subsequent
    transactions.
   </P
><P
>    The <VAR
CLASS="LITERAL"
>SCROLL</VAR
> option should be specified when defining a
    cursor that will be used to fetch backwards.  This is required by
    the SQL standard.  However, for compatibility with earlier
    versions, <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> will allow
    backward fetches without <VAR
CLASS="LITERAL"
>SCROLL</VAR
>, if the cursor's query
    plan is simple enough that no extra overhead is needed to support
    it. However, application developers are advised not to rely on
    using backward fetches from a cursor that has not been created
    with <VAR
CLASS="LITERAL"
>SCROLL</VAR
>.  If <VAR
CLASS="LITERAL"
>NO SCROLL</VAR
> is
    specified, then backward fetches are disallowed in any case.
   </P
><P
>    The SQL standard only makes provisions for cursors in embedded
    <ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>.  The <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>
    server does not implement an <TT
CLASS="COMMAND"
>OPEN</TT
> statement for
    cursors; a cursor is considered to be open when it is declared.
    However, <SPAN
CLASS="APPLICATION"
>ECPG</SPAN
>, the embedded SQL
    preprocessor for <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>, supports
    the standard SQL cursor conventions, including those involving
    <TT
CLASS="COMMAND"
>DECLARE</TT
> and <TT
CLASS="COMMAND"
>OPEN</TT
> statements.
   </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN41086"
></A
><H2
>Examples</H2
><P
>   To declare a cursor:
</P><PRE
CLASS="PROGRAMLISTING"
>DECLARE liahona CURSOR FOR SELECT * FROM films;</PRE
><P>
   See <A
HREF="sql-fetch.html"
><I
>FETCH</I
></A
> for more
   examples of cursor usage.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN41091"
></A
><H2
>Compatibility</H2
><P
>   The SQL standard allows cursors only in embedded
   <ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
> and in modules. <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>
   permits cursors to be used interactively.
  </P
><P
>   The SQL standard allows cursors to update table data. All
   <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> cursors are read only.
  </P
><P
>   Binary cursors are a <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>
   extension.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-deallocate.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-delete.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>DEALLOCATE</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>DELETE</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>