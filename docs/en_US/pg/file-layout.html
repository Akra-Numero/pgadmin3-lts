<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Chapter 49. Database File Layout</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.64.1">
<link rel="home" href="index.html" title="PostgreSQL 8.0.0beta5 Documentation">
<link rel="up" href="internals.html" title="Part VII. Internals">
<link rel="previous" href="examples.html" title="48.5. Examples">
<link rel="next" href="page.html" title="Chapter 50. Database Page Layout">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter" lang="en" id="file-layout">
<div class="titlepage">
<div><div><h2 class="title">
<a name="file-layout"></a>Chapter 49. Database File Layout</h2></div></div>
<div></div>
</div>
<div class="abstract">
<p class="title"><b>Abstract</b></p>
<p>A description of the database physical storage layout.</p>
</div>
<p>This section provides an overview of the physical format used by
<span class="productname">PostgreSQL</span> databases.</p>
<p>All the data needed for a database cluster is stored within the cluster's data
directory, commonly referred to as <tt class="varname">PGDATA</tt> (after the name of the
environment variable that can be used to define it).  A common location for
<tt class="varname">PGDATA</tt> is <tt class="filename">/var/lib/pgsql/data</tt>.  Multiple clusters,
managed by different postmasters, can exist on the same machine.</p>
<p>The <tt class="varname">PGDATA</tt> directory contains several subdirectories and control
files, as shown in <a href="file-layout.html#pgdata-contents-table" title="Table 49.1. Contents of PGDATA">Table 49.1, &#8220;Contents of PGDATA&#8221;</a>.  In addition to
these required items, the cluster configuration files
<tt class="filename">postgresql.conf</tt>, <tt class="filename">pg_hba.conf</tt>, and
<tt class="filename">pg_ident.conf</tt> are traditionally stored in
<tt class="varname">PGDATA</tt> (although beginning in
<span class="productname">PostgreSQL</span> 8.0 it is possible to keep them
elsewhere). </p>
<div class="table">
<a name="pgdata-contents-table"></a><p class="title"><b>Table 49.1. Contents of <tt class="varname">PGDATA</tt></b></p>
<table summary="Contents of PGDATA" border="1">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>Item</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><tt class="filename">PG_VERSION</tt></td>
<td>A file containing the major version number of <span class="productname">PostgreSQL</span>
</td>
</tr>
<tr>
<td><tt class="filename">base</tt></td>
<td>Subdirectory containing per-database subdirectories</td>
</tr>
<tr>
<td><tt class="filename">global</tt></td>
<td>Subdirectory containing cluster-wide tables, such as
 <tt class="structname">pg_database</tt>
</td>
</tr>
<tr>
<td><tt class="filename">pg_clog</tt></td>
<td>Subdirectory containing transaction commit status data</td>
</tr>
<tr>
<td><tt class="filename">pg_subtrans</tt></td>
<td>Subdirectory containing subtransaction status data</td>
</tr>
<tr>
<td><tt class="filename">pg_tblspc</tt></td>
<td>Subdirectory containing symbolic links to tablespaces</td>
</tr>
<tr>
<td><tt class="filename">pg_xlog</tt></td>
<td>Subdirectory containing WAL (Write Ahead Log) files</td>
</tr>
<tr>
<td><tt class="filename">postmaster.opts</tt></td>
<td>A file recording the command-line options the postmaster was
last started with</td>
</tr>
<tr>
<td><tt class="filename">postmaster.pid</tt></td>
<td>A lock file recording the current postmaster PID and shared memory
segment ID (not present after postmaster shutdown)</td>
</tr>
</tbody>
</table>
</div>
<p>For each database in the cluster there is a subdirectory within
<tt class="varname">PGDATA</tt><tt class="filename">/base</tt>, named after the database's OID in
<tt class="structname">pg_database</tt>.  This subdirectory is the default location
for the database's files; in particular, its system catalogs are stored
there.</p>
<p>Each table and index is stored in a separate file, named after the table
or index's <i class="firstterm">filenode</i> number, which can be found in
<tt class="structname">pg_class</tt>.<tt class="structfield">relfilenode</tt>.</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Caution</h3>
<p>Note that while a table's filenode often matches its OID, this is
<span class="emphasis"><em>not</em></span> necessarily the case; some operations, like
<tt class="command">TRUNCATE</tt>, <tt class="command">REINDEX</tt>, <tt class="command">CLUSTER</tt> and some forms
of <tt class="command">ALTER TABLE</tt>, can change the filenode while preserving the OID.
Avoid assuming that filenode and table OID are the same.</p>
</div>
<p>When a table or index exceeds 1Gb, it is divided into gigabyte-sized
<i class="firstterm">segments</i>.  The first segment's file name is the same as the
filenode; subsequent segments are named filenode.1, filenode.2, etc.
This arrangement avoids problems on platforms that have file size limitations.
The contents of tables and indexes are discussed further in
<a href="page.html" title="Chapter 50. Database Page Layout">Chapter 50, <i>Database Page Layout</i></a>.</p>
<p>A table that has columns with potentially large entries will have an
associated <i class="firstterm">TOAST</i> table, which is used for out-of-line storage of
field values that are too large to keep in the table rows proper.
<tt class="structname">pg_class</tt>.<tt class="structfield">reltoastrelid</tt> links from a table to
its TOAST table, if any.</p>
<p>Tablespaces make the scenario more complicated.  Each user-defined tablespace
has a symbolic link inside the <tt class="varname">PGDATA</tt><tt class="filename">/pg_tblspc</tt>
directory, which points to the physical tablespace directory (as specified in
its <tt class="command">CREATE TABLESPACE</tt> command).  The symbolic link is named after
the tablespace's OID.  Inside the physical tablespace directory there is
a subdirectory for each database that has elements in the tablespace, named
after the database's OID.  Tables within that directory follow the filenode
naming scheme.  The <tt class="literal">pg_default</tt> tablespace is not accessed through
<tt class="filename">pg_tblspc</tt>, but corresponds to
<tt class="varname">PGDATA</tt><tt class="filename">/base</tt>.  Similarly, the <tt class="literal">pg_global</tt>
tablespace is not accessed through <tt class="filename">pg_tblspc</tt>, but corresponds to
<tt class="varname">PGDATA</tt><tt class="filename">/global</tt>.</p>
</div></body>
</html>
